{
  "schema_version": "1.0.0",
  "description": "Feedback record schema for agent run outcomes",
  "fields": {
    "bead": {
      "type": "string",
      "description": "Bead identifier for the run"
    },
    "timestamp": {
      "type": "string",
      "format": "iso8601",
      "description": "When the feedback record was created"
    },
    "template": {
      "type": "string",
      "description": "Prompt template used for the run"
    },
    "agent": {
      "type": "string",
      "description": "Agent that executed the run"
    },
    "model": {
      "type": "string",
      "description": "LLM model used"
    },
    "outcome": {
      "type": "string",
      "enum": ["full_pass", "partial_pass", "agent_failure", "infra_failure", "timeout"],
      "description": "Outcome classification from outcome.json types"
    },
    "signals": {
      "type": "object",
      "description": "Extracted verification signals",
      "fields": {
        "exit_clean": {
          "type": "boolean",
          "description": "Agent process exited cleanly"
        },
        "tests_pass": {
          "type": "boolean",
          "description": "All tests passed"
        },
        "lint_pass": {
          "type": "boolean",
          "description": "Linting passed"
        },
        "ubs_clean": {
          "type": "boolean",
          "description": "No undefined behavior sanitizer issues"
        },
        "truthsayer_clean": {
          "type": "boolean",
          "description": "Truthsayer verification passed"
        },
        "duration_ratio": {
          "type": "number",
          "description": "Actual duration / expected duration ratio"
        },
        "retried": {
          "type": "boolean",
          "description": "Whether this run was a retry of a previous attempt"
        }
      }
    },
    "failure_patterns": {
      "type": "array",
      "items": "string",
      "description": "Tagged failure pattern identifiers"
    },
    "opus_quality_score": {
      "type": ["number", "null"],
      "description": "Optional Opus quality score in [0,1] when qualitative review runs"
    },
    "opus_judge": {
      "type": ["object", "null"],
      "description": "Optional qualitative judge payload for this run",
      "fields": {
        "judge_model": {
          "type": "string",
          "description": "Judge model identifier (for example, opus)"
        },
        "style_rating": {
          "type": "number",
          "description": "Style rating on a 1-5 scale"
        },
        "maintainability_rating": {
          "type": "number",
          "description": "Maintainability rating on a 1-5 scale"
        },
        "critique": {
          "type": "string",
          "description": "Concise qualitative critique from the judge"
        },
        "judged_at": {
          "type": "string",
          "format": "iso8601",
          "description": "Timestamp for the judge assessment"
        }
      }
    },
    "prompt_hash": {
      "type": "string",
      "description": "SHA256 hash of the prompt content for dedup"
    }
  }
}
